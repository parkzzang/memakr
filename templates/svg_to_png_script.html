<script>
  console.log('âœ… SVG to PNG ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨');
  
  function convertSVGToPNG(file, callback) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const svgText = e.target.result;
      const img = new Image();
      const svgBlob = new Blob([svgText], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(svgBlob);
  
      img.onload = function () {
        const canvas = document.createElement('canvas');
        canvas.width = img.width || 512;
        canvas.height = img.height || 512;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        canvas.toBlob(function (blob) {
          callback(blob);
          URL.revokeObjectURL(url);
        }, 'image/png');
      };
  
      img.onerror = function () {
        alert('SVG â†’ PNG ë³€í™˜ ì‹¤íŒ¨');
      };
  
      img.src = url;
    };
    reader.readAsText(file);
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    const forms = document.querySelectorAll('form');
  
    if (forms.length === 0) {
      console.warn('âš  form í•˜ë‚˜ë„ ì•ˆ ì°¾ìŒ');
      return;
    }
  
    forms.forEach(form => {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData(form);
        const fileInputs = form.querySelectorAll('input[type="file"]');
        const promises = [];
  
        fileInputs.forEach(input => {
          const file = input.files[0];
          if (!input.name) {
            console.warn(`âš  input[name] ì—†ìŒ (id: ${input.id})`);
            return;
          }
  
          if (file && file.name.toLowerCase().endsWith('.svg')) {
            console.log(`ðŸ–¼ï¸ ${file.name} â†’ PNG ë³€í™˜ ì¤‘... (${input.name})`);
            const promise = new Promise(resolve => {
              convertSVGToPNG(file, (pngBlob) => {
                formData.set(input.name, pngBlob, file.name.replace(/\.svg$/i, '.png'));
                resolve();
              });
            });
            promises.push(promise);
          }
        });
  
        Promise.all(promises).then(() => {
          console.log('ðŸ“¤ ì„œë²„ë¡œ í¼ ì „ì†¡...');
          fetch(form.action, {
            method: 'POST',
            body: formData
          }).then(res => res.text())
            .then(html => {
              document.body.innerHTML = html;
            });
        });
      });
    });
  });
  </script>
  